---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: tekton-results
resources:
  - namespace.yaml
  - route.yaml
  - https://github.com/tektoncd/results//config/?ref=76159a71b785cdb8c1db8613ec0a5e569b7118a2
images:
  - name: ko://github.com/tektoncd/results/cmd/api
    newName: quay.io/redhat-appstudio/pull-request-builds
    newTag: tekton-results-api-9aa097f142c4b8821af778cf17e70d12ec484f66
  - name: ko://github.com/tektoncd/results/cmd/watcher
    newName: quay.io/redhat-appstudio/pull-request-builds
    newTag: tekton-results-watcher-9aa097f142c4b8821af778cf17e70d12ec484f66

# configMapGenerator:
#   - name: api-config
#     namespace: tekton-results
#     files:
#       - https://raw.githubusercontent.com/tektoncd/results/76159a71b785cdb8c1db8613ec0a5e569b7118a2/config/env/config

patchesJson6902:
  - target:
      kind: Namespace
      name: tekton-results
    patch: |-
      - op: add
        path: "/metadata/labels"
        value:
          argocd.argoproj.io/managed-by: openshift-gitops
  - target:
      kind: Service
      name: tekton-results-api-service
      namespace: tekton-results
    patch: |-
      - op: add
        path: "/metadata/annotations"
        value:
          service.beta.openshift.io/serving-cert-secret-name: tekton-results-tls
  # - target:
  #     kind: Deployment
  #     name: tekton-results-api
  #     namespace: tekton-results
  #   patch: |-
  #     - op: remove
  #       path: /spec/template/spec/containers/0/env/3/value
  #     - op: add
  #       path: /spec/template/spec/containers/0/env/3/valueFrom
  #       value:
  #         secretKeyRef:
  #           key: db.name
  #           name: tekton-results-postgres
  #     - op: add
  #       path: /spec/template/spec/containers/0/env/2/valueFrom
  #       value:
  #         secretKeyRef:
  #           key: db.host
  #           name: tekton-results-postgres

